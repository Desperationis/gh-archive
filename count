#!/bin/bash

# count - Count locally saved repositories for a user/org

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

if [[ $# -lt 1 ]]; then
	echo "Usage: ./count [username/org] (-c optional)"
	exit 1
fi

user="$1"
user_dir="$SCRIPT_DIR/accounts/$user"

if ! [[ -d "$user_dir" ]]; then
	echo "ERROR: $user/ does not exist."
	exit 1
fi

# Count directories that are git repos
count=0
for dir in "$user_dir"/*/; do
	[[ -d "$dir" ]] || continue
	[[ -d "$dir/.git" ]] || continue
	((count++))
done

if [[ "$2" == "-c" ]]; then
	echo "$count"
else
	echo "There are $count repositories archived for $user."
fi
